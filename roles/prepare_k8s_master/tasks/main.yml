---
# tasks file for prepare_kubernetes

- name: Add keys
  block:
    - name: Add Kubernetes signing key
      ansible.builtin.apt_key:
        url: https://packages.cloud.google.com/apt/doc/apt-key.gpg
        state: present

    - name: Add kubernetes repo
      ansible.builtin.apt_repository:
        repo: deb http://apt.kubernetes.io/ kubernetes-xenial main
        state: present

- name: Run "apt-get update"
  ansible.builtin.apt:
    update_cache: yes

- name: Install client tools
  block:
    - name: Transfer scripts
      copy: src=./ dest=/home/{{ ansible_user }} mode=0777
      register: transfer_scripts
      notify: "Execute the tools scripts"
  tags:
    - client_tools

      #   ansible.builtin.apt:
      #     name:
      #       - kubectl:v1.21.0
      #       - kubernetes-cni
      #       - kubelet
      #       - kubeadm

    # - name: Hold kubeadm nad kubelet
    #   dpkg_selections:
    #     name:
    #       # - kubeadm
    #       - kubelet
    #     selection: hold
